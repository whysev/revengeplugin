(function(u,a,R,i,n,y,p){"use strict";const{View:E,ScrollView:v,TouchableOpacity:I}=a.ReactNative,{FormText:d,FormInput:l,FormRow:m,FormSwitchRow:C,FormSection:o}=y.Forms,r=i.storage;function T(){p.useProxy(r),(!r.selected||!r.selections?.[r.selected])&&(n.logger.warn("[RPC] Resetting invalid profile"),r.selected="default",r.selections??={},r.selections.default??={name:"Discord",application_id:"1054951789318909972",flags:0,type:0,timestamps:{_enabled:!1,start:Date.now()},assets:{},buttons:[{},{}]});const e=p.useProxy(r.selections[r.selected]);return a.React.createElement(v,{style:{paddingBottom:24}},a.React.createElement(E,{style:{padding:16}},a.React.createElement(d,{style:{marginBottom:12}},"Configure your custom RPC below."),a.React.createElement(I,{style:{backgroundColor:"#5865F2",padding:12,borderRadius:8,alignItems:"center",marginBottom:16},onPress:function(){n.logger.log("[RPC] Manual update"),g.onUnload(),g.onLoad()}},a.React.createElement(d,{style:{color:"white"}},"Update Presence")),a.React.createElement(o,{title:"Basic"},a.React.createElement(l,{title:"Application Name",placeholder:"Discord",value:e.name,onChange:function(t){return e.name=t}}),a.React.createElement(l,{title:"Application ID",placeholder:"1054951789318909972",value:e.application_id,onChange:function(t){return e.application_id=t},keyboardType:"numeric",helpText:"Geeked out stuff but you can use your own bot's application ID"}),a.React.createElement(l,{title:"Activity Type (0-5)",placeholder:"0",value:String(e.type??0),onChange:function(t){return e.type=Number(t)},keyboardType:"numeric",helpText:"Playing, Streaming, Listening, Watching, Custom, Competing"}),a.React.createElement(l,{title:"Details",placeholder:"Competitive",value:e.details,onChange:function(t){return e.details=t}}),a.React.createElement(l,{title:"State",placeholder:"Playing Solo",value:e.state,onChange:function(t){return e.state=t}})),a.React.createElement(o,{title:"Images"},a.React.createElement(l,{title:"Large Image",placeholder:"asset_key or URL",value:e.assets?.large_image,onChange:function(t){return e.assets.large_image=t}}),a.React.createElement(l,{title:"Large Image Text",placeholder:"Displayed on hover",value:e.assets?.large_text,disabled:!e.assets?.large_image,onChange:function(t){return e.assets.large_text=t}}),a.React.createElement(l,{title:"Small Image",placeholder:"asset_key or URL",value:e.assets?.small_image,onChange:function(t){return e.assets.small_image=t}}),a.React.createElement(l,{title:"Small Image Text",placeholder:"Displayed on hover",value:e.assets?.small_text,disabled:!e.assets?.small_image,onChange:function(t){return e.assets.small_text=t}}),a.React.createElement(d,{style:{marginLeft:16,marginTop:4}},"Image keys can be Discord app asset names or direct URLs.")),a.React.createElement(o,{title:"Timestamps"},a.React.createElement(C,{label:"Enable timestamps",value:e.timestamps._enabled,onValueChange:function(t){return e.timestamps._enabled=t}}),a.React.createElement(l,{title:"Start (ms)",placeholder:"e.g. 1680000000000",value:String(e.timestamps?.start??""),disabled:!e.timestamps._enabled,onChange:function(t){return e.timestamps.start=Number(t)},keyboardType:"numeric"}),a.React.createElement(l,{title:"End (ms)",placeholder:"optional",value:String(e.timestamps?.end??""),disabled:!e.timestamps._enabled,onChange:function(t){return e.timestamps.end=Number(t)},keyboardType:"numeric"}),a.React.createElement(m,{label:"Use current time",subLabel:"Set now as start timestamp",disabled:!e.timestamps._enabled,trailing:m.Arrow,onPress:function(){return e.timestamps.start=Date.now()}})),a.React.createElement(o,{title:"Buttons"},a.React.createElement(l,{title:"Button 1 Label",placeholder:"Label",value:e.buttons?.[0]?.label,onChange:function(t){return e.buttons[0].label=t}}),a.React.createElement(l,{title:"Button 1 URL",placeholder:"https://example.com",value:e.buttons?.[0]?.url,disabled:!e.buttons?.[0]?.label,onChange:function(t){return e.buttons[0].url=t},helpText:e.buttons?.[0]?.label&&!e.buttons?.[0]?.url?a.React.createElement(a.ReactNative.Text,{style:{color:"red"}},"Required if button label is set"):void 0}),a.React.createElement(l,{title:"Button 2 Label",placeholder:"Label",value:e.buttons?.[1]?.label,onChange:function(t){return e.buttons[1].label=t}}),a.React.createElement(l,{title:"Button 2 URL",placeholder:"https://example.com",value:e.buttons?.[1]?.url,disabled:!e.buttons?.[1]?.label,onChange:function(t){return e.buttons[1].url=t},helpText:e.buttons?.[1]?.label&&!e.buttons?.[1]?.url?a.React.createElement(a.ReactNative.Text,{style:{color:"red"}},"Required if button label is set"):void 0}))))}function _(e){return e===!1||e===0?!0:e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e=="object"?Object.keys(e).length>0:!0}function P(e){return JSON.parse(JSON.stringify(e,function(t,s){if(s===e)return s;if(!(typeof t=="string"&&t.startsWith("_")))return _(s)?s:void 0}))}const b=R.findByProps("getAssetIds"),h=Date.now();var A=function(e){return e[e.PLAYING=0]="PLAYING",e[e.STREAMING=1]="STREAMING",e[e.LISTENING=2]="LISTENING",e[e.WATCHING=3]="WATCHING",e[e.COMPETING=5]="COMPETING",e}(A||{});function L(){return{name:"Reveg\xA9",application_id:"1054951789318909972",flags:0,type:0,timestamps:{_enabled:!1,start:h},assets:{},buttons:[{},{}]}}(!i.storage.selected||typeof i.storage.selected!="string")&&(n.logger.log("[Rich Presence] Initializing default storage"),i.storage.selected="default",i.storage.selections={default:L()});async function f(e){if(e===null)return a.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:null,pid:1608,socketId:"RPC@Reveg"}),n.logger.log("[Rich Presence] Cleared activity"),null;n.logger.log("[Rich Presence] Preparing activity:",e);const t=e.timestamps?._enabled;if(e=P(e),t?(typeof e.timestamps.start!="number"&&(e.timestamps.start=h),(typeof e.timestamps.end!="number"||e.timestamps.end===0)&&delete e.timestamps.end,Object.keys(e.timestamps).length===0&&delete e.timestamps):delete e.timestamps,e.assets)try{const s=[e.application_id,[e.assets.large_image,e.assets.small_image]];let c=b.getAssetIds(...s);c.length||(c=await b.fetchAssetIds(...s)),e.assets.large_image=c[0]??e.assets.large_image,e.assets.small_image=c[1]??e.assets.small_image}catch(s){n.logger.error("[Rich Presence] Failed to resolve asset IDs:",s)}return e.buttons?.length?(e.buttons=e.buttons.filter(function(s){return s&&s.label}),e.buttons.length?Object.assign(e,{metadata:{button_urls:e.buttons.map(function(s){return s.url})},buttons:e.buttons.map(function(s){return s.label})}):delete e.buttons):delete e.buttons,a.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:e,pid:1608,socketId:"RichPresence@Vendetta"}),n.logger.log("[Rich Presence] Activity sent:",e),e}var g={onLoad(){const e=i.storage.selections?.[i.storage.selected];if(!e){n.logger.error("[Rich Presence] Invalid selected profile:",i.storage.selected);return}f(e).catch(function(t){return n.logger.error("[Rich Presence] Send failed:",t)})},onUnload(){f(null)},settings:T};return u.default=g,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.metro.common,vendetta.metro,vendetta.plugin,vendetta,vendetta.ui.components,vendetta.storage);
